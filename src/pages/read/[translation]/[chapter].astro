---
import type { MarkdownInstance } from "astro";
import Base from "../../../layouts/base.astro";
import Chapter from "../../../components/Chapter.astro";
import codes from "../../../data/codes";
import type {
  TranslationCode,
  Chapter as ChapterType,
} from "../../../data/codes";
import SourceFooter from "../../../components/SourceFooter.astro";
import { Icon } from "astro-icon";

export function getStaticPaths() {
  return codes
    .map((code) => ({
      params: {
        translation: code,
      },
    }))
    .flatMap((path) => {
      let aux = [];
      // 53 is a magic number taken from the number of chapters the book has, so I'm pretty confident it will not change and break stuff
      for (let i = 1; i <= 53; i++) {
        aux.push({
          params: {
            ...path.params,
            chapter: i.toString(),
          },
        });
      }
      return aux;
    });
}

const { translation, chapter } = Astro.params as unknown as {
  translation: TranslationCode;
  chapter: ChapterType;
};

export interface Frontmatter {
  Author: string;
  Title: string;
  Translator: string;
  Date: string;
  Source: {
    label: string;
    url: string;
  };
  Code: string;
  Chapter: string;
}

const MD = (await import(
  `../../../data/${translation}/chapters/${chapter}.md`
)) as MarkdownInstance<Frontmatter>;
---

<Base 
  title={`Chapter ${chapter}, ${MD.frontmatter.Translator}'s translation â€” The manual, a compilation of the Enchiridion translations`} 
  description={`Read the chapter ${chapter} of ${MD.frontmatter.Translator}'s Translation of the Enchiridion. We compiled translations from diferent authors at diferent points of history alongisde the original Enchiridion from Epictetus to make sure you can easily read and share your favorite version of it.`}
>
  <div class="flex flex-col px-12 py-16 justify-between min-h-screen gap-40">
    <div class="flex flex-col gap-20 mx-auto">
      <Chapter
        translationCode={translation}
        chapterNumber={chapter.toString()}
        chapterHead={MD.frontmatter.Chapter}
        chapterId={`${translation}-${chapter}`}
      >
        <MD.Content key={chapter} />
      </Chapter>

      <div>
        <a
          class="flex gap-1 items-center p-2 -ml-2 w-max underline underline-offset-2 outline-none focus-visible:ring ring-zinc-900 ring-offset-zinc-100 ring-offset-2 group"
          rel="prefetch"
          href={`/read/${MD.frontmatter.Code}#${MD.frontmatter.Chapter}`}
          >Continue reading<Icon
            class="inline h-[15px] w-[15px] transition-transform transform translate-y-[1px] group-hover:translate-x-1"
            name="radix-icons:arrow-right"
          />
        </a>
      </div>
    </div>

    <SourceFooter
      url={MD.frontmatter.Source.url}
      label={MD.frontmatter.Source.label}
    />
  </div>
</Base>
